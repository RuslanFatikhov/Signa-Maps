{% extends "base.html" %}

{% block title %}TOFU Maps{% endblock %}

{% block content %}
<div class="app-shell">
  <div class="app-stage" id="appStage">
  
    

  <div class="main-ui">
    <!--Map-->
    <div class="header-map" id="map"></div>

    <div class="menu">
      <!--Header-->
      <header class="site-header">

        

        <!--Header-->
        <div class="header  vstack gap2">
          <h2 id="listTitle" class="prime100">My map</h2>
          <input id="listTitleInput" class="listTitleInput" type="text" value="My map" style="display:none;">

          <!--List header-->
          <div class="hstack list-header">
            <span id="placeCount" class="card-meta"></span>
          </div>
        </div>

      </header>

      <main class="layout">
          

          <section class="list-panel">

          <div id="places" class="card-stack"></div>
        </section>
      </main>
    </div>
  </div>

  <div class="undo-banner" id="undoBanner" aria-live="polite" style="display:none;">
    <span class="undo-banner__text" id="undoText">Point deleted</span>
    <button class="btn_label_ghost_invert" type="button" id="undoBtn">Undo</button>
  </div>

  

  



  


  

  

  <div class="toast" id="shareToast" role="status" aria-live="polite">
    <div class="toast__body">
      <div class="toast__text">
        <p class="toast__title" id="shareToastTitle">Link copied</p>
      </div>
      <button class="toast__close" type="button" id="shareToastClose" aria-label="Закрыть уведомление">
        <img src="{{ url_for('static', filename='img/icons/cross.svg') }}" alt="" aria-hidden="true">
      </button>
    </div>
  </div>

  

  </div>


<!--Left Menu-->
<aside class="lists-panel" id="listsPanel" aria-hidden="true">
    <header class="vstack gap4">

        <a href="/about" class="hstack gap2 aic left_menu_service pd_lr4 pd_t4">
          <img class="tofu-icon" src="{{ url_for('static', filename='img/tofu-br.svg') }}" alt="Tofu icon">
          <p class="secondary-200">TOFU MAPS</p>
        </a>

        <span class="hstack gap2 aic pd_lr4">
          <h2 class="lists-panel__title prime-100 w100">My maps</h2>
          <button class="btn_icon_ghost lists-panel__close" type="button" id="listsPanelClose" aria-label="Закрыть списки">
          <img src="{{ url_for('static', filename='img/icons/cross.svg') }}" alt="Close">
        </button>
        </span>

        


        
    </header>

    <!--Toolbar List-->
    <div class="lists-panel__toolbar toolbar">

      <span class="hstack w100 gap4">
          <!--Edit map-->
          <button class="btn_icon_ghost gap2" type="button" id="listEditToggle">
            <img src="{{ url_for('static', filename='img/icons/pen.svg') }}" alt="Edit">
            <p class="secondary-200">Edit</p>
          </button>

          <span class="hstack w100 gap4">
            <button class="btn_label_stroke  w100" type="button" id="listEditCancel" style="display:none;">Cancel</button>
            <button class="btn_label_fill_primary" type="button" id="listEditSave" style="display:none;">Save</button>
          </span>

          <!--New map-->
          <button class="btn_icon_ghost gap2" type="button" id="createListBtn">
            <img src="{{ url_for('static', filename='img/icons/plus.svg') }}" alt="Create New map">
            <p class="secondary-200">New</p>
          </button>
      </span>
    </div>

    <div class="lists-panel__body" id="listsPanelBody"></div>

</aside>
<div class="lists-backdrop" id="listsBackdrop" aria-hidden="true"></div>
</div>

<!--Place information-->
<div class="sheet-backdrop" id="viewSheetBackdrop" aria-hidden="true"></div>
<section class="sheet sheet--info" id="viewSheet" aria-hidden="true">
    <!--Toolbar-->
    <div class="toolbar point_info_toolbar">
        
        <span class="hstack w100 sb">
          
          <button class="btn_icon_ghost" id="viewEditBtn" type="button" title="Edit place">
            <img src="/static/img/icons/pen.svg" alt="Edit place">
          </button>
          <button class="btn_icon_ghost" id="viewShareBtn" type="button" title="Share List">
            <img src="/static/img/icons/share.svg" alt="Share">
          </button>
          <button class="btn_icon_ghost" id="viewOpenBtn" type="button" title="Add">
            <img src="/static/img/icons/forward.svg" alt="Add">
          </button>
          <button class="btn_label_stroke" id="view-cancel-btn" type="button" title="Cancel" style="display:none;">
            Cancel
          </button>
          <button class="btn_label_fill_primary" id="view-save-btn" type="button" title="Save" style="display:none;">
            Save
          </button>
        </span>
    </div>
    
    <div class="sheet__content">

      <!--Header-->
      <header class="sheet__header sheet__header--info">
        <h3 class="sheet__title" id="viewTitle">Untitled</h3>
        <button class="btn_icon_ghost" type="button" id="viewSheetClose" aria-label="Закрыть шторку">
          <img src="/static/img/icons/cross.svg" alt="Close">
        </button>
      </header>

      <!--Map-->
      <div id="viewMap" class="view-map mapboxgl-map" role="presentation"><div class="mapboxgl-canary" style="visibility: hidden;"></div><div class="mapboxgl-canvas-container mapboxgl-interactive"><canvas class="mapboxgl-canvas" tabindex="0" aria-label="Map" role="region" width="1200" height="640" style="width: 600px; height: 320px;"></canvas><div aria-label="Map marker" role="img" class="mapboxgl-marker mapboxgl-marker-anchor-center" style="transform: translate(300px, 160px) translate(-50%, -50%) translate(0px, -14px); opacity: 1; pointer-events: auto;"><svg display="block" height="41px" width="27px" viewBox="0 0 27 41"><defs><radialGradient id="shadowGradient"><stop offset="10%" stop-opacity="0.4"></stop><stop offset="100%" stop-opacity="0.05"></stop></radialGradient></defs><ellipse cx="13.5" cy="34.8" rx="10.5" ry="5.25" fill="url(#shadowGradient)"></ellipse><path fill="#121212" d="M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"></path><path opacity="0.25" d="M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"></path><circle fill="white" cx="13.5" cy="13.5" r="5.5"></circle></svg></div></div><div class="mapboxgl-control-container"><div class="mapboxgl-ctrl-top-left"></div><div class="mapboxgl-ctrl-top-right"></div><div class="mapboxgl-ctrl-bottom-left"><div class="mapboxgl-ctrl" style="display: block;"><a class="mapboxgl-ctrl-logo" target="_blank" rel="noopener nofollow" href="https://www.mapbox.com/" aria-label="Mapbox logo"></a></div></div><div class="mapboxgl-ctrl-bottom-right"></div></div></div>

      <!--Point information-->
      <div class="sheet_info_information">


        <!--Place information-->
        <div class="sheet__section">
          <h3 class="sheet__value" id="viewMapLabel">43.23263, 76.95367</h3>
        </div>

        <div class="sheet__section">
          <p class="caption secondary-200">Address</p>
          <p class="sheet__value" id="viewAddress">43.23263, 76.95367</p>
        </div>

        <!--Description-->
        <div class="sheet__section">
          <p class="sheet__note" id="viewNote"></p>
        </div>

        <!--Details-->
        <!--div class="sheet__section" id="viewDetailsSection">
          <table class="info-table" id="viewDetailsTable">
            <tbody id="viewDetailsBody"></tbody>
          </table>
          <template id="viewDetailsRowTemplate">
            <tr class="info-table__row">
              <th scope="row" class="info-table__key"></th>
              <td class="info-table__value"></td>
            </tr>
          </template>
        </div-->

        <!--Photos later-->
        <!--div id="viewPhotos" class="photo-grid"></div-->
      </div>
    </div>

</section>


<!--Open map-->
<div class="sheet-backdrop" id="openMapSheetBackdrop" aria-hidden="true"></div>
<section class="sheet sheet--info" id="openMapSheet" aria-hidden="true">
    <div class="sheet__handle"></div>
    <div class="sheet__content">
      <header class="sheet__header">
        <h2 class="prime100">Open place</h2>
        <button class="btn_icon_ghost" type="button" id="openMapSheetClose" aria-label="Закрыть шторку">
          <img src="{{ url_for('static', filename='img/icons/cross.svg') }}" alt="Close">
        </button>
      </header>
      <div class="cell-list" id="openMapServiceList">
        <button class="cell" type="button" data-map-service="2gis">2GIS</button>
        <button class="cell" type="button" data-map-service="yandex">Yandex Maps</button>
        <button class="cell" type="button" data-map-service="apple">Apple Maps</button>
        <button class="cell" type="button" data-map-service="google">Google Maps</button>
      </div>
    </div>
</section>

<!--Share sheet-->
<div class="sheet-backdrop" id="shareSheetBackdrop" aria-hidden="true"></div>
<section class="sheet sheet--info" id="shareSheet" aria-hidden="true">
    <div class="sheet__handle"></div>
    <div class="sheet__content">
      <header class="sheet__header">
        <h2 class="prime100" id="shareSheetTitle">Share map</h2>
        <button class="btn_icon_ghost" type="button" id="shareSheetClose" aria-label="Закрыть шторку">
          <img src="{{ url_for('static', filename='img/icons/cross.svg') }}" alt="Close">
        </button>
      </header>
      <div class="vstack gap2 pd_lr4">
        <button class="btn_label_secondary_fill sb" type="button" data-share="gpx">Share as GPX <img src="{{ url_for('static', filename='img/icons/file.svg') }}" alt="" aria-hidden="true"></button>
      </div>
      <div class="share-qr" id="shareSheetQr" aria-live="polite">
        <div class="share-qr__code" id="shareSheetQrCode"></div>
        <p class="caption secondary-200" id="shareSheetQrLabel"></p>
      </div>

      <div class="sheet__submit sheet__submit--share">
          <div class="share-toggle">
            <span class="vstack"><h4 class="prime100">Viewer can edit</h4></span>
            <label class="toggle">
              <input id="shareEditableToggle" type="checkbox" aria-label="Viewer can edit">
              <span class="toggle__track" aria-hidden="true"></span>
            </label>
          </div>
          <button class="btn_label_fill_primary" id="shareListBtn" type="button">Share map</button>
      </div>
    </div>
</section>

<!--Search sheet-->
<div class="sheet-backdrop" id="searchSheetBackdrop" aria-hidden="true"></div>
<section class="sheet sheet--info" id="searchSheet" aria-hidden="true">
    <div class="sheet__handle"></div>
    <div class="sheet__content">
      <header class="sheet__header">
        <div>
          <h2 class="prime-100">Search results</h2>
        </div>
        <button class="btn_icon_ghost" type="button" id="searchSheetClose" aria-label="Закрыть шторку">
          <img src="{{ url_for('static', filename='img/icons/cross.svg') }}" alt="Close">
        </button>
      </header>
      <div class="field pdlr4">
        <div class="field__search_clear">
          <img src="{{ url_for('static', filename='img/icons/search.svg') }}" alt="" aria-hidden="true">
          <input class="w100" id="searchSheetInput" type="search" placeholder="Search">
        </div>
      </div>
      <div class="field pdlr4">
        <div id="searchSheetList" class="search-results"></div>
      </div>
    </div>
</section>

<!--Add place sheet-->
<div class="sheet-backdrop" id="addSheetBackdrop" aria-hidden="true"></div>
<section class="sheet" id="addSheet" aria-hidden="true">
    <div class="sheet__content">
      <header class="sheet__header">
          <h2 class="prime100" id="placeSheetTitle">New place</h2>
         <button class="btn_icon_ghost" type="button" id="sheetClose" aria-label="Закрыть шторку">
          <img src="{{ url_for('static', filename='img/icons/cross.svg') }}" alt="Close">
        </button>
        
      </header>

      <form id="placeForm" class="sheet__form">
        <input id="placeLat" name="lat" type="hidden">
        <input id="placeLng" name="lng" type="hidden">

        <!--Search-->
        <div class="field pdlr4" style="position: absolute; left: 0px; top: 86px; width: 100%; z-index: 100;">
          <button class="field__search" id="searchTrigger" type="button">
            <img src="{{ url_for('static', filename='img/icons/search.svg') }}" alt="" aria-hidden="true">
            <span class="field__search-label">Search place</span>
          </button>
        </div>

        <!--Map-->
        <div class="field">
          <div class="sheet-map-wrap" id="sheetMapWrap">
            <div id="sheetMap" class="sheet-map" role="presentation"></div>
            <div class="sheet-map__controls">

              <!--Fullscreen is broken. Back when it will be fixed-->
              <!--button
                type="button"
                class="btn_icon_label_primary_invert"
                id="sheetMapFullToggle"
                aria-label="На весь экран"
                data-icon-expand="{{ url_for('static', filename='img/icons/maximize.svg') }}"
                data-icon-collapse="{{ url_for('static', filename='img/icons/minimize.svg') }}"
              >
                <img src="{{ url_for('static', filename='img/icons/maximize.svg') }}" alt="" aria-hidden="true">
              </button-->
            </div>
          </div>
        </div>

        

        <div class="field pdlr4 hstack gap4 fs">
          <p class="prime-100 fw700" style="margin-top: var(--space-3); width: var(--space-10);">Name</p>
          <input name="title" id="placeTitle" type="text" placeholder="Point name">
        </div>

        <div class="field pdlr4 hstack gap4 fs">
          <p class="prime-100 fw700" style="margin-top: var(--space-3); width: var(--space-10);">Note</p>
          <textarea name="note" id="placeNote" rows="3" placeholder="Any note"></textarea>
        </div>

        <!--Photo is disabled in ver 1.0-->
        <!--div class="field pdlr4">
          <div class="field__row">
            <label class="field__label"  for="photosInput">Photos</label>
            <span class="field__hint">Up to 10 JPG/PNG, compressed to 2 MB</span>
          </div>
          <input id="photosInput" type="file" accept="image/jpeg,image/png" multiple>
          <div id="photoPreview" class="photo-preview"></div>
        </div-->


        <p class="form-error" id="formError" role="alert"></p>
        
        <div class="sheet__submit">
          <button class="btn_label_fill_primary" type="submit">Save point</button>
        </div>
      </form>

    </div>
</section>

<!--Main toolbar-->
<div class="toolbar toolbar--fixed-main">
  <span class="hstack w100 sb">

    <!--New-list-->
    <button class="btn_icon_ghost" id="listToggleBtn" data-lists-toggle="true" type="button" title="Lists">
      <img src="{{ url_for('static', filename='img/icons/new-list.svg') }}" alt="Edit">
    </button>

    <button class="btn_icon_ghost" id="edit-btn" type="button" title="Edit map">
      <img src="{{ url_for('static', filename='img/icons/pen.svg') }}" alt="Edit">
    </button>
    <button class="btn_icon_ghost" id="share-btn" type="button" title="Share List">
      <img src="{{ url_for('static', filename='img/icons/share.svg') }}" alt="Share">
    </button>
    <button class="btn_icon_ghost" id="add-btn" type="button" title="Add">
      <img src="{{ url_for('static', filename='img/icons/plus.svg') }}" alt="Add">
    </button>

    <button class="btn_label_ghost w100" id="cancel-btn" type="button" title="Cancel" style="display:none;">
      Cancel
    </button>
    <button class="btn_label_fill_primary" id="save-btn" type="button" title="Save" style="display:none;">
      Save
    </button>

  </span>
</div>

{% endblock %}

{% block scripts %}
  {{ super() }}
  <script src="{{ url_for('static', filename='js/qr.js') }}"></script>
  <script src="{{ url_for('static', filename='js/toast.js') }}"></script>
  <script src="{{ url_for('static', filename='js/storage.js') }}"></script>
  <script src="{{ url_for('static', filename='js/map.js') }}"></script>
  <script src="{{ url_for('static', filename='js/render.js') }}"></script>
  <script src="{{ url_for('static', filename='js/view.js') }}"></script>
  <script src="{{ url_for('static', filename='js/form.js') }}"></script>
  <script src="{{ url_for('static', filename='js/share.js') }}"></script>
  <script src="{{ url_for('static', filename='js/edit.js') }}"></script>
  <script src="{{ url_for('static', filename='js/app.js') }}"></script>
{% endblock %}
