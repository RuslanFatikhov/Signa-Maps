{% extends "base.html" %}

{% block title %}TOFU Maps{% endblock %}

{% block content %}
<div class="app-shell">
  <div class="app-stage" id="appStage">
    <div class="app-loading" id="appLoading" aria-live="polite">Loading…</div>
  
    

  <div class="main-ui">
    <!--Map-->
    <div class="header-map" id="map"></div>

    <div class="menu">
      <!--Header-->
      <header class="site-header">

        

        <!--Header-->
        <div class="header  vstack gap2">
          <h2 id="listTitle" class="prime-100">My map</h2>
          <input id="listTitleInput" class="listTitleInput" type="text" value="My map" style="display:none;">
          <p class="connection-hint" id="offlineHint" hidden>Offline mode</p>

          <!--List header-->
          <div class="hstack list-header">
            <span id="placeCount" class="card-meta"></span>
          </div>
        </div>

      </header>

      <main class="layout">
          

          <section class="list-panel">
          <div class="list-search" id="listSearch" style="display:none;">
            <img src="{{ url_for('static', filename='img/icons/search.svg') }}" alt="" aria-hidden="true">
            <input id="listSearchInput" type="search" placeholder="Search in list">
          </div>
          <div id="places" class="card-stack"></div>
        </section>
      </main>
    </div>
  </div>

  <div class="undo-banner" id="undoBanner" aria-live="polite" style="display:none;">
    <span class="undo-banner__text" id="undoText">Point deleted</span>
    <button class="btn_label_ghost_invert" type="button" id="undoBtn">Undo</button>
  </div>

  

  



  


  

  

  <div class="toast" id="shareToast" role="status" aria-live="polite">
    <div class="toast__body">
      <div class="toast__text">
        <p class="toast__title" id="shareToastTitle">Link copied</p>
      </div>
      <button class="toast__close" type="button" id="shareToastClose" aria-label="Закрыть уведомление">
        <img src="{{ url_for('static', filename='img/icons/cross.svg') }}" alt="" aria-hidden="true">
      </button>
    </div>
  </div>

  

  </div>


<!--Left Menu-->
<aside class="lists-panel" id="listsPanel" aria-hidden="true">
    <header class="vstack gap4">

        <a href="/about" class="hstack gap2 aic left_menu_service pd_lr4 pd_t4">
          <img class="tofu-icon" src="{{ url_for('static', filename='img/tofu-br.svg') }}" alt="Tofu icon">
          <p class="secondary-200">TOFU MAPS</p>
        </a>

        <span class="hstack gap2 aic pd_lr4">
          <h2 class="lists-panel__title prime-100 w100">My maps</h2>
          <button class="btn_icon_ghost lists-panel__close" type="button" id="listsPanelClose" aria-label="Закрыть списки">
          <img src="{{ url_for('static', filename='img/icons/cross.svg') }}" alt="Close">
        </button>
        </span>

        


        
    </header>

    <!--Toolbar List-->
    <div class="lists-panel__toolbar toolbar">

      <span class="hstack w100 gap4">
          <!--Edit map-->
          <button class="btn_icon_ghost gap2" type="button" id="listEditToggle">
            <img src="{{ url_for('static', filename='img/icons/pen.svg') }}" alt="Edit">
            <p class="secondary-200">Edit</p>
          </button>

          <span class="hstack w100 gap4">
            <button class="btn_label_stroke  w100" type="button" id="listEditCancel" style="display:none;">Cancel</button>
            <button class="btn_label_fill_primary" type="button" id="listEditSave" style="display:none;">Save</button>
          </span>

          <!--New map-->
          <button class="btn_icon_ghost gap2" type="button" id="createListBtn">
            <img src="{{ url_for('static', filename='img/icons/plus.svg') }}" alt="Create New map">
            <p class="secondary-200">New</p>
          </button>
      </span>
    </div>

    <div class="lists-panel__body" id="listsPanelBody"></div>

</aside>
<div class="lists-backdrop" id="listsBackdrop" aria-hidden="true"></div>

<input id="listImportInput" type="file" accept=".gpx,.csv,.kmz" hidden>

<div class="import-overlay" id="importOverlay" aria-hidden="true">
  <section class="import-overlay__panel" data-import-panel="loading" hidden>
    <img
      class="import-overlay__gif"
      src="{{ url_for('static', filename='img/gif/scanning.gif') }}"
      alt="Loading"
    >
    <p class="secondary-200">Importing...</p>
  </section>

  <section class="import-overlay__panel" data-import-panel="success" hidden>
    <img src="{{ url_for('static', filename='img/icons/success.svg') }}" alt="Success" aria-hidden="true" class="w200">
    <h2 class="prime-100 tac">Import complete</h2>
    <p class="secondary-200 tac">Your file has been converted into a new list. <br>You can edit it or start exploring right away.</p>
    <div class="import-overlay__actions">
      
      <button class="btn_label_fill_primary w100" id="importSuccessAnother" type="button">Upload new file</button>
      <button class="btn_label_secondary_fill w100" id="importSuccessToList" type="button">To the list</button>
      
    </div>
  </section>

  <section class="import-overlay__panel" data-import-panel="fail" hidden>
    <h2 class="prime-100">Import failed</h2>
    <p class="secondary-200" id="importFailText">We couldn’t process this file. Please try again.</p>
    <div class="import-overlay__actions">
      <button class="btn_label_fill_primary w100" id="importFailRetry" type="button">Повторить</button>
      <button class="btn_label_stroke w100" id="importFailExit" type="button">Выйти</button>
    </div>
  </section>
</div>
</div>

<!--Password gate-->
<div class="share-gate" id="sharePasswordGate" aria-hidden="true">
  <div class="share-gate__panel">
    <h2 class="prime-100">Enter your password</h2>
    <p class="secondary-200">This list is password protected.</p>
    <input id="shareGateInput" type="password" placeholder="Password">
    <button class="btn_label_fill_primary" id="shareGateOpen" type="button" disabled>Open</button>
  </div>
</div>

{% include "components/view_sheet.html" %}
{% include "components/open_map_sheet.html" %}
{% include "components/share_sheet.html" %}
{% include "components/share_password_sheet.html" %}
{% include "components/share_qr_sheet.html" %}
{% include "components/search_sheet.html" %}
{% include "components/add_sheet.html" %}

<!--Main toolbar-->
<div class="toolbar toolbar--fixed-main">
  <span class="hstack w100 sb">

    <!--New-list-->
    <button class="btn_icon_ghost" id="listToggleBtn" data-lists-toggle="true" type="button" title="Lists">
      <img src="{{ url_for('static', filename='img/icons/new-list.svg') }}" alt="Edit">
    </button>

    <button class="btn_icon_ghost" id="edit-btn" type="button" title="Edit map">
      <img src="{{ url_for('static', filename='img/icons/pen.svg') }}" alt="Edit">
    </button>
    <button class="btn_icon_ghost" id="share-btn" type="button" title="Share List">
      <img src="{{ url_for('static', filename='img/icons/share.svg') }}" alt="Share">
    </button>
    <button class="btn_icon_ghost" id="add-btn" type="button" title="Add">
      <img src="{{ url_for('static', filename='img/icons/plus.svg') }}" alt="Add">
    </button>

    <button class="btn_label_ghost w100" id="cancel-btn" type="button" title="Cancel" style="display:none;">
      Cancel
    </button>
    <button class="btn_label_fill_primary" id="save-btn" type="button" title="Save" style="display:none;">
      Save
    </button>

  </span>
</div>

{% endblock %}

{% block scripts %}
  {{ super() }}
  <script src="{{ url_for('static', filename='js/qr.js') }}"></script>
  <script src="{{ url_for('static', filename='js/toast.js') }}"></script>
  <script src="{{ url_for('static', filename='js/map_links.js') }}"></script>
  <script src="{{ url_for('static', filename='js/storage.js') }}"></script>
  <script src="{{ url_for('static', filename='js/map.js') }}"></script>
  <script src="{{ url_for('static', filename='js/render.js') }}"></script>
  <script src="{{ url_for('static', filename='js/view.js') }}"></script>
  <script src="{{ url_for('static', filename='js/form.js') }}"></script>
  <script src="{{ url_for('static', filename='js/share.js') }}"></script>
  <script src="{{ url_for('static', filename='js/edit.js') }}"></script>
  <script src="{{ url_for('static', filename='js/app.js') }}"></script>
{% endblock %}
